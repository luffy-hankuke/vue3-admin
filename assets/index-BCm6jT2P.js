import{f as u}from"./dateUtil-NBcmMhwL.js";import{k as f,d as x,W as w,X as k,Y as c,G as C,u as h,ac as g}from"./vue-Dbi1xauY.js";import{U as P}from"./antdv-CAXihDg_.js";import{u as _}from"./dynamic-table-DhiAq_hs.js";import{A as i}from"./index-DWJF4vuV.js";import"./ApiSelect.vue_vue_type_script_setup_true_lang-IWTYr-Fy.js";import"./index.vue_vue_type_style_index_0_lang-Dww9ZzaR.js";import{u as v}from"./useFormModal-DGpV1vZs.js";import"./schema-form.vue_vue_type_script_setup_true_lang-C0d9vjpU.js";import"./is-C0dFuREE.js";import"./index-CCwlABZW.js";import"./useModal-BsEyE0vB.js";const R=[{title:"#",dataIndex:"id",width:55,hideInSearch:!0},{title:"角色名称",width:200,dataIndex:"name"},{title:"角色值",width:180,dataIndex:"value"},{title:"状态",dataIndex:"status",width:80,formItemProps:{component:"Select",componentProps:{options:[{label:"启用",value:1},{label:"禁用",value:0}]}},customRender:({record:l})=>{const r=~~l.status===1;return f(P,{color:r?"green":"red"},{default:()=>[r?"启用":"停用"]})}},{title:"备注",dataIndex:"remark"},{title:"创建时间",dataIndex:"createdAt",hideInSearch:!0,customRender:({record:l})=>u(l.createdAt)},{title:"更新时间",dataIndex:"updatedAt",hideInSearch:!0,customRender:({record:l})=>u(l.createdAt)}],A=[{field:"name",component:"Input",label:"角色名称",rules:[{required:!0,type:"string"}],colProps:{span:12}},{field:"value",component:"Input",label:"角色值",rules:[{required:!0,type:"string"}],colProps:{span:12}},{field:"status",label:"状态",component:"RadioGroup",defaultValue:1,componentProps:{options:[{label:"启用",value:1},{label:"停用",value:0}]}},{field:"remark",component:"InputTextArea",label:"备注"},{field:"menuIds",component:"Tree",label:"菜单权限",componentProps:{checkable:!0,vModelKey:"checkedKeys",fieldNames:{title:"name",key:"id"},style:{height:"350px",paddingTop:"5px",overflow:"auto",borderRadius:"6px",border:"1px solid #dcdfe6",resize:"vertical"}}}],G=x({name:"SystemPermissionRole",__name:"index",setup(l){const[r,n]=_(),[b]=v(),m=(e,t,o=[])=>t.reduce((a,s)=>{var d;return(d=s.children)!=null&&d.length?m(e,s.children,o):e.includes(s.id)&&a.push(s.id),a},o),p=async e=>{const[t]=await b({modalProps:{title:`${e.id?"编辑":"新增"}角色`,width:"50%",onFinish:async a=>{e.id&&(a.roleId=e.id);const s=t==null?void 0:t.compRefMap.get("menuIds"),d={...a,menuIds:[...s.halfCheckedKeys,...s.checkedKeys]};e.id?await i.systemRole.roleUpdate({id:e.id},d):await i.systemRole.roleCreate(d),n==null||n.reload()}},formProps:{labelWidth:100,schemas:A}}),o=await i.systemMenu.menuList({});if(t==null||t.updateSchema([{field:"menuIds",componentProps:{treeData:o}}]),e.id){const a=await i.systemRole.roleInfo({id:e.id});t==null||t.setFieldsValue({...e,menuIds:m(a.menuIds,o)})}},y=async e=>{await i.systemRole.roleDelete({id:e.id}),n==null||n.reload()},I=[...R,{title:"操作",width:130,dataIndex:"ACTION",hideInSearch:!0,fixed:"right",actions:({record:e})=>[{label:"编辑",auth:{perm:"system:role:update",effect:"disable"},onClick:()=>{p(e)}},{label:"删除",auth:"system:role:delete",popConfirm:{title:"你确定要删除吗？",placement:"left",onConfirm:()=>y(e)}}]}];return(e,t)=>{const o=g("a-button");return w(),k(h(r),{"row-key":"id","header-title":"角色管理","title-tooltip":"超级管理员默认拥有所有资源访问权限且不支持修改","data-request":h(i).systemRole.roleList,columns:I,bordered:"",size:"small"},{toolbar:c(()=>[f(o,{type:"primary",disabled:!e.$auth("system:role:create"),onClick:t[0]||(t[0]=a=>p({}))},{default:c(()=>[C(" 新增 ")]),_:1},8,["disabled"])]),_:1},8,["data-request"])}}});export{G as default};
