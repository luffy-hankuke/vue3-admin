import{J as q,K as D,M as S,N as E,O as T,g as z,_ as F,d as k,A as y,Q as G,D as K}from"./index-DWJF4vuV.js";import{f as B}from"./dateUtil-NBcmMhwL.js";import{d as j,at as L,as as U,f as w,c as W,W as _,X as P,Y as c,k as r,a5 as M,F as H,ae as J,u as d,ai as Q,_ as X,am as Y,a as Z,G as b,l as R,g as ee,a6 as te,ac as ne}from"./vue-Dbi1xauY.js";import{z as oe,T as ae,L as se,b8 as le,an as ie,U as h}from"./antdv-CAXihDg_.js";import{f as re,s as A}from"./common-FuI8P1Oj.js";import{u as pe}from"./dynamic-table-DhiAq_hs.js";import"./ApiSelect.vue_vue_type_script_setup_true_lang-IWTYr-Fy.js";import"./index.vue_vue_type_style_index_0_lang-Dww9ZzaR.js";import{u as ue}from"./useFormModal-DGpV1vZs.js";import"./schema-form.vue_vue_type_script_setup_true_lang-C0d9vjpU.js";import"./is-C0dFuREE.js";import"./index-CCwlABZW.js";import"./useModal-BsEyE0vB.js";const ce=["title","onClick"],de=j({inheritAttrs:!1,__name:"IconPicker",props:L(q,{value:{},valueModifiers:{}}),emits:["update:value"],setup(e){D();const i=U(e,"value"),n=Object.entries(S).reduce((o,[s,l])=>(o[s]=Object.keys(l.icons).map(g=>({name:`${l.prefix}:${g}`})),o),{全部:Object.values(S).flatMap(o=>Object.keys(o.icons).map(s=>({name:`${o.prefix}:${s}`})))}),p=w(!1),a=w("全部"),m=w(""),v=W(()=>n[a.value].filter(s=>s.name.includes(m.value))),I=z(o=>{m.value=o.target.value},100),t=o=>{i.value=o,p.value=!1};return(o,s)=>{const l=oe,g=ae,C=se,O=le,N=ie;return _(),P(N,null,{default:c(()=>[r(O,{open:p.value,"onUpdate:open":s[2]||(s[2]=u=>p.value=u),placement:"bottomLeft","overlay-inner-style":{paddingTop:0},trigger:"click"},{title:c(()=>[r(g,{activeKey:a.value,"onUpdate:activeKey":s[0]||(s[0]=u=>a.value=u),size:"small","tab-bar-style":{marginBottom:"8px"}},{default:c(()=>[(_(!0),M(H,null,J(d(n),(u,x)=>(_(),P(l,{key:x,tab:x},null,8,["tab"]))),128))]),_:1},8,["activeKey"]),r(C,{autofocus:"","allow-clear":"",placeholder:`从“${a.value}”中搜索图标`,onChange:d(I)},null,8,["placeholder","onChange"])]),content:c(()=>[r(d(E),{class:"select-box",items:v.value,"key-field":"name","item-size":38,"grid-items":9,"item-secondary-size":38},{default:c(({item:u})=>[(_(),M("div",{key:u.name,title:u.name,class:Q([{active:i.value==u.name},"select-box-item"]),onClick:x=>t(u.name)},[r(d(T),{icon:u.name,class:"text-[20px]"},null,8,["icon"])],10,ce))]),_:1},8,["items"])]),default:c(()=>[r(C,X(o.$attrs,{value:i.value,"onUpdate:value":s[1]||(s[1]=u=>i.value=u),placeholder:o.placeholder,"allow-clear":""}),Y({_:2},[i.value?{name:"prefix",fn:c(()=>[r(d(T),{icon:i.value,class:"text-[20px]"},null,8,["icon"])]),key:"0"}:void 0]),1040,["value","placeholder"])]),_:1},8,["open"])]),_:1})}}}),me=F(de,[["__scopeId","data-v-7c9eece7"]]);function $(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Z(e)}const fe=e=>{switch(e){case 0:return r(h,{color:"warning"},{default:()=>[b("目录")]});case 1:return r(h,{color:"success"},{default:()=>[b("菜单")]});case 2:return r(h,{color:"error"},{default:()=>[b("权限")]});default:return""}},ye=[{title:"名称",dataIndex:"name",align:"left",fixed:"left",width:200},{title:"图标",width:40,dataIndex:"icon",hideInSearch:!0,customRender:({record:e})=>e.icon&&r(k,{icon:e.icon,size:"22"},null)},{title:"类型",width:80,dataIndex:"type",hideInSearch:!0,customRender:({record:e})=>fe(e.type)},{title:"节点路由",dataIndex:"path",width:180,ellipsis:!0},{title:"文件路径",width:180,dataIndex:"component"},{title:"权限标识",width:180,dataIndex:"permission",hideInSearch:!0,customRender:({record:e})=>e.permission&&r(h,{color:"processing"},{default:()=>[e.permission]})},{title:"排序",width:50,dataIndex:"orderNo",hideInSearch:!0},{title:"路由缓存",dataIndex:"keepalive",width:80,hideInSearch:!0,customRender:({record:e})=>e.type===1&&(e.keepAlive?"是":"否")},{title:"是否显示",dataIndex:"show",width:80,hideInSearch:!0,customRender:({record:e})=>{const n=~~e.show===1,p=n?"green":"red",a=n?"显示":"隐藏";return r(h,{color:p},$(a)?a:{default:()=>[a]})}},{title:"状态",dataIndex:"status",width:80,hideInSearch:!0,customRender:({record:e})=>{const n=~~e.status===1,p=n?"green":"red",a=n?"启用":"停用";return r(h,{color:p},$(a)?a:{default:()=>[a]})}},{title:"更新时间",width:180,dataIndex:"updatedAt",hideInSearch:!0,customRender({text:e}){return B(e)}}],be=e=>e===0,V=e=>e===1,f=e=>e===2,he=()=>[{field:"type",component:"RadioGroup",label:"菜单类型",defaultValue:0,rules:[{required:!0,type:"number"}],componentProps:{options:[{label:"目录",value:0},{label:"菜单",value:1},{label:"权限",value:2}]}},{field:"name",component:"Input",label:({formModel:e})=>f(e.type)?"权限名称":"节点名称",rules:[{required:!0,type:"string"}]},{field:"parentId",component:"TreeSelect",label:"上级节点",componentProps:{fieldNames:{label:"name",value:"id"},request:async({schema:e,formModel:i})=>{const n=await y.systemMenu.menuList({}),p=[-1].concat(re(n,i.parentId)||[]);return e.value.componentProps.treeDefaultExpandedKeys=p,[{id:-1,name:"根目录",children:n}]},getPopupContainer:()=>document.body},rules:[{required:!0,type:"number"}]},{field:"path",component:"Input",label:"路由地址",vIf:({formModel:e})=>!f(e.type),rules:[{required:!0,type:"string"}]},{field:"permission",component:"Input",label:"权限",helpMessage:"对应控制器中定义的权限字符，如：@Perm('system:menu:list'))",vIf:({formModel:e})=>!be(e.type),required:({formModel:e})=>f(e.type),afterSlot:({schema:e,formInstance:i,formModel:n})=>e.value.component==="Input"?R(k,{icon:"ant-design:folder-open-outlined",title:"选择权限",class:"ml-[12px] cursor-pointer",onclick:async()=>{const p=await y.systemMenu.menuGetPermissions();typeof n.permission=="string"&&(n.permission=n.permission.split(":")),i.updateSchema({field:"permission",component:"Cascader",componentProps:{displayRender:({labels:a})=>a.join(":"),options:p.reduce((a,m)=>(A(m,a,":"),a),[])}})}}):R(k,{icon:"ant-design:edit-outlined",title:"手动输入",class:"ml-[12px] cursor-pointer",onclick:()=>{Array.isArray(n.permission)&&(n.permission=n.permission.join(":")),i.updateSchema({field:"permission",component:"Input"})}})},{field:"component",component:"Cascader",label:"文件路径",vIf:({formModel:e})=>V(e.type)&&!e.isExt,componentProps:{options:Object.keys(G).reduce((e,i)=>(A(i,e,"/"),e),[])},rules:[{required:!0,type:"array"}]},{field:"icon",component:()=>me,label:"节点图标",vIf:({formModel:e})=>!f(e.type)},{field:"orderNo",component:"InputNumber",label:"排序号",defaultValue:255,componentProps:{style:{width:"100%"}}},{field:"isExt",component:"RadioGroup",label:"是否外链",defaultValue:!1,helpMessage:"选择是外链则路由地址需要以`http(s)://`开头",colProps:{span:12},componentProps:{optionType:"button",buttonStyle:"solid",options:[{label:"是",value:!0},{label:"否",value:!1}]},vIf:({formModel:e})=>!f(e.type)},{field:"extOpenMode",component:"RadioGroup",label:"打开方式",defaultValue:1,vIf:({formModel:e})=>!f(e.type)&&e.isExt,colProps:{span:12},componentProps:{optionType:"button",buttonStyle:"solid",options:[{label:"新窗口打开",value:1},{label:"内嵌页打开",value:2}]}},{field:"keepAlive",component:"RadioGroup",label:"是否缓存",defaultValue:0,vIf:({formModel:e})=>V(e.type),colProps:{span:12},componentProps:{optionType:"button",buttonStyle:"solid",options:[{label:"是",value:1},{label:"否",value:0}]}},{field:"show",component:"RadioGroup",label:"是否显示",defaultValue:1,colProps:{span:12},helpMessage:"会生成路由,但左侧菜单不可见",componentProps:{optionType:"button",buttonStyle:"solid",options:[{label:"是",value:1},{label:"否",value:0}]},vIf:({formModel:e})=>!f(e.type)},{field:"activeMenu",component:"Input",label:"高亮菜单项",colProps:{span:12},helpMessage:"值为某个的节点的路由地址(可设置当前路由高亮的菜单项，多用于详情页)",componentProps:{placeholder:"需要高亮的菜单项(节点名称)"},vIf:({formModel:e})=>!e.show&&!f(e.type)},{field:"status",label:"状态",component:"RadioGroup",defaultValue:1,helpMessage:"不会生成路由,同时左侧菜单不可见",componentProps:{optionType:"button",buttonStyle:"solid",options:[{label:"启用",value:1},{label:"禁用",value:0}]}}],_e={class:"flex gap-2 ml-2"},$e=j({name:"SysMenu",__name:"index",setup(e){const[i,n]=pe({pagination:!1,size:"small",rowKey:"id",bordered:!0,autoHeight:!0}),[p]=ue(),a=ee();K(document.documentElement,()=>{var o;const t=(o=a==null?void 0:a.proxy)==null?void 0:o.$el;t&&n.setProps({scroll:{x:window.innerWidth>2e3?t.offsetWidth-20:2e3}})});const m=async t=>{var s;const[o]=await p({modalProps:{title:`${t.id?"编辑":"新增"}菜单`,width:700,onFinish:async l=>{t.id&&(l.menuId=t.id),Array.isArray(l.component)&&(l.component=l.component.join("/")),Array.isArray(l.permission)&&(l.permission=l.permission.join(":")),l.parentId===-1&&Reflect.deleteProperty(l,"parentId"),t.id?await y.systemMenu.menuUpdate({id:t.id},l):await y.systemMenu.menuCreate(l),n.reload()}},formProps:{labelWidth:100,schemas:he()}});o==null||o.setFieldsValue({...t,icon:t.icon??"",parentId:t.parentId??-1,component:(s=t.component)==null?void 0:s.split("/")})},v=async t=>{await y.systemMenu.menuDelete({id:t.id}),n.reload()},I=[...ye,{title:"操作",width:160,dataIndex:"ACTION",hideInSearch:!0,fixed:"right",actions:({record:t})=>[{label:"编辑",auth:{perm:"system:menu:update",effect:"disable"},onClick:()=>m(t)},{label:"新增",auth:{perm:"system:menu:create",effect:"disable"},disabled:t.type===2||t.status===0,onClick:()=>m({parentId:t.id})},{label:"删除",auth:"system:menu:delete",popConfirm:{title:"你确定要删除吗？",placement:"left",onConfirm:()=>v(t)}}]}];return(t,o)=>{const s=ne("a-button");return _(),P(d(i),{"header-title":"菜单管理","data-request":d(y).systemMenu.menuList,columns:I},{afterHeaderTitle:c(()=>[te("div",_e,[r(s,{onClick:d(n).expandAll},{default:c(()=>[b("展开全部")]),_:1},8,["onClick"]),r(s,{onClick:d(n).collapseAll},{default:c(()=>[b("折叠全部")]),_:1},8,["onClick"])])]),toolbar:c(()=>[r(s,{type:"primary",disabled:!t.$auth("system:menu:create"),onClick:o[0]||(o[0]=l=>m({}))},{default:c(()=>[b(" 新增 ")]),_:1},8,["disabled"])]),_:1},8,["data-request"])}}});export{$e as default};
